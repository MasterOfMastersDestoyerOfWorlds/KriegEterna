{{ define "title" -}}
{{ .Title | title }}
{{- end }}
{{ define "main" -}}
{{ partial "amazonbanner.html" . }}
{{ .Content }}
<section class="gradient even-gradient">
	<div class="main-section">
		<div class="title-wrapper">
			{{ partial "outlined-title" (dict "title" .Title "h" "h2" "class" "main-title") }}
			<div class="rule-paragraph" style="text-align: center; margin-left: auto; margin-right: auto;">
				Click on a card to learn more about its strategy, artwork, and history!
			</div>
			<div class="search">
				<input type="text" id="search" placeholder="Search cards by name or type">
				<button id="clear-search">
					{{ partial "icon-backspace.html" . }}
				</button>
			</div>
		</div>
		<script>
			// @license magnet:?xt=urn:btih:5ac446d35272cc2e4e85e4325b146d0b7ca8f50c&dn=unlicense.txt Unlicense
			document.addEventListener("DOMContentLoaded", () => {
				for (e of document.getElementsByClassName("js-only")) {
					e.classList.remove("js-only");
				}

				const recipes = document.querySelectorAll("#list li");
				const search = document.getElementById("search");
				//const oldheading = document.getElementById("newest-recipes");
				const clearSearch = document.getElementById("clear-search");
				const artlist = document.getElementById("list");

				search.addEventListener("input", () => {
					// grab search input value
					const searchText = search.value.toLowerCase().trim().normalize('NFD').replace(/\p{Diacritic}/gu, "");
					const searchTerms = searchText.split(" ");
					const hasFilter = searchText.length > 0;

					artlist.classList.toggle("list-searched", hasFilter);
					//oldheading.classList.toggle("hidden", hasFilter);

					// for each recipe hide all but matched
					recipes.forEach(recipe => {
						const searchString = `${recipe.textContent} ${recipe.dataset.tags}`.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, "");
						const isMatch = searchTerms.every(term => searchString.includes(term));

						recipe.hidden = !isMatch;
						recipe.classList.toggle("matched-recipe", hasFilter && isMatch);
					})
				})

				clearSearch.addEventListener("click", () => {
					search.value = "";
					recipes.forEach(recipe => {
						recipe.hidden = false;
						recipe.classList.remove("matched-recipe");
					})

					artlist.classList.remove("list-searched");
					oldheading.classList.remove("hidden");
				})
			})
			// @license-end

		</script>

		<ul id="list" class="list">
			{{- range.Pages }}
			<li class="tag" data-tags="{{.Page.Params.tags}}">
				<a href="{{ .RelPermalink }}">
					{{partial "cardflip" (dict "Params" (dict "front" .Params.code "back" .Params.back "big" "true" "disallowFlip" "true" "tooltip" "true"))}}
				</a>
			</li>
			{{- end }}
		</ul>
	</div>
</section>
{{- end }}